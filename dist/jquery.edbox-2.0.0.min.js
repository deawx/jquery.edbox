!function(e,o){function t(t,n){if(o=this,o.opt=e.extend({},e.edbox.defaults,t),o.opt.beforeOpen(),o.target=o.opt.target||e(n).attr("data-box-target")||e(n).attr("href"),o.html=o.opt.html||e(n).attr("data-box-html"),o.image=o.opt.image||e(n).attr("data-box-image"),o.url=o.opt.url||e(n).attr("data-box-url"),!(o.target||o.html||o.image||o.url))return void console.error("undefined content. Try to set any of contents option like target: '#element'");o.box=e('<div class="'+o.opt.prefix+'"/>'),o.boxLoad=e('<div class="'+o.opt.prefix+'-load"/>'),o.boxBody=e('<div class="'+o.opt.prefix+'-body"/>'),o.boxClose=e('<div class="'+o.opt.prefix+'-close"/>'),o.boxContainer=e('<div class="'+o.opt.prefix+'-container"/>'),o.boxContent=e('<div class="'+o.opt.prefix+'-content"/>'),o.boxHeader=e('<div class="'+o.opt.prefix+'-header"/>'),o.boxFooter=e('<div class="'+o.opt.prefix+'-footer"/>'),o.boxTemp=e('<div class="'+o.opt.prefix+'-temp"/>'),o.animateEvents="webkitAnimationEnd oanimationend msAnimationEnd animationend",o.events={click:function(e){o.opt.close&&e.target==e.currentTarget&&o.animate("close")},keydown:function(e){o.opt.close&&27==e.which&&o.animate("close")},resize:function(){var e=o.boxContainer.outerHeight()<o.boxContent.outerHeight();o.boxBody[e?"addClass":"removeClass"](o.opt.prefix+"-scroll-true")}},o.init()}t.prototype.init=function(){return o.target?(o.target=e(o.target),void(o.target.length?(o.target.after(o.boxTemp),o.base().insert(o.target.addClass(o.opt.prefix+"-helper-class"))):console.error('Unable to find element "'+o.target+'"'))):o.html?void o.base().insert(o.html):o.image?(o.base(),o.imageObj=new Image,o.imageObj.src=o.image,void(o.imageObj.complete?o.insert(o.imageObj):o.load(o.image))):o.url?void o.base().load(o.url):void 0},t.prototype.load=function(t){o.loading=!0,o.box.append(o.boxLoad),o.animate("open",function(){o.urlLoad=e.get(t).fail(function(){o.animate("close",function(){o.box.remove()})}).done(function(e){o.animate("close",function(){o.loading=!1,o.boxLoad.remove(),o.insert(o.imageObj||e)})})})},t.prototype.base=function(){return e("body").prepend(o.box.addClass(o.opt.parentClass).one("click",o.events.click)),e(window).one("keydown",o.events.keydown),this},t.prototype.insert=function(t){o.box.append(o.boxBody.css({width:o.opt.width,height:o.opt.height}).append(o.opt.header&&o.boxHeader.html(o.opt.header),o.boxClose.one("click",o.events.click),o.boxContainer.append(o.boxContent.append(t)),o.opt.footer&&o.boxFooter.html(o.opt.footer))),!o.opt.close&&o.boxClose.css("display","none"),e(window).on("resize",o.events.resize).resize(),o.animate("open")},t.prototype.animate=function(t,n){var a={open:function(){o.loading||(o.image&&o.boxLoad.remove(),o.opt.afterOpen())},close:function(){e(window).off({keydown:o.events.keydown,resize:o.events.resize}),o.target&&o.target.removeClass(o.opt.prefix+"-helper-class").appendTo(o.boxTemp).unwrap(),o.loading?o.urlLoad.abort():o.opt.afterClose(),o.box.remove()}};o.opt.animation?(o.loading?o.boxLoad:o.boxBody).addClass("open"==t?o.opt.animateOpen:o.opt.animateClose).one(o.animateEvents,function(){"function"==typeof n?n():a[t]()}):"function"==typeof n?n():a[t]()},e.edbox=function(o){var n=e.data(window,"edboxData");"string"==typeof o&&"close"===o&&"object"==typeof n?(n.animate("close"),e.removeData(window,"edboxData")):"object"!=typeof o||n||e.data(window,"edboxData",new t(o))},e.fn.edbox=function(o){this.on("click",function(n){n.preventDefault(),e.data(window,"edboxData",new t(o,this))})},e.edbox.defaults={target:null,html:null,image:null,url:null,width:null,height:null,prefix:"edbox",parentClass:"",header:"",footer:"",close:!0,animation:!0,animateOpen:"edbox-animate-open",animateClose:"edbox-animate-close",beforeOpen:function(){},beforeClose:function(){},afterOpen:function(){},afterClose:function(){}}}(jQuery);