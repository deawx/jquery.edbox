!function(e,o,t){function n(n,a){if(t=this,t.opt=o.extend({},e,n),t.opt.beforeOpen(),t.target=t.opt.target||o(a).attr("data-box-target")||o(a).attr("href"),t.html=t.opt.html||o(a).attr("data-box-html"),t.image=t.opt.image||o(a).attr("data-box-image"),t.url=t.opt.url||o(a).attr("data-box-url"),!(t.target||t.html||t.image||t.url))return void console.error("undefined content. Try to set any of contents option like target: '#element'");t.box=o('<div class="'+t.opt.prefix+'"/>'),t.boxLoad=o('<div class="'+t.opt.prefix+'-load"/>'),t.boxBody=o('<div class="'+t.opt.prefix+'-body"/>'),t.boxClose=o('<div class="'+t.opt.prefix+'-close"/>'),t.boxContent=o('<div class="'+t.opt.prefix+'-content"/>'),t.boxHeader=o('<div class="'+t.opt.prefix+'-header"/>'),t.boxFooter=o('<div class="'+t.opt.prefix+'-footer"/>'),t.boxTemp=o('<div class="'+t.opt.prefix+'-temp"/>'),t.animateEvents="webkitAnimationEnd oanimationend msAnimationEnd animationend",t.init()}n.prototype={init:function(){return t.target?(t.target=o(t.target),void(t.target.length?(t.target.after(t.boxTemp),t.base().insert(t.target.addClass(t.opt.prefix+"-helper-class"))):console.error('Unable to find element "'+t.target+'"'))):t.html?void t.base().insert(t.html):t.image?(t.base(),t.imageObj=new Image,t.imageObj.src=t.image,void(t.imageObj.complete?t.insert(t.imageObj):t.load(t.image))):t.url?void t.base().load(t.url):void 0},load:function(e){t.loading=!0,t.box.append(t.boxLoad),t.toggle("open",function(){t.urlLoad=o.get(e).fail(function(){t.toggle("close",function(){t.box.remove()})}).done(function(e){t.toggle("close",function(){t.loading=!1,t.boxLoad.remove(),t.insert(t.imageObj||e)})})})},events:{click:function(e){t.opt.close&&e.target==e.currentTarget&&t.toggle("close")},keydown:function(e){t.opt.close&&27==e.which&&t.toggle("close")},resize:function(){var e=t.boxBody.outerHeight(),o=t.boxHeader.outerHeight(),n=t.boxFooter.outerHeight(),a=t.boxContent.get(0).scrollHeight,i=Math.ceil(e-(o+n))<a;t.boxBody[i?"addClass":"removeClass"](t.opt.prefix+"-scroll-true")}},base:function(){return o("body").prepend(t.box.addClass(t.opt.parentClass).one("click",t.events.click)),o(window).one("keydown",t.events.keydown),this},insert:function(e){t.box.append(t.boxBody.css({width:t.opt.width,height:t.opt.height}).append(t.opt.header&&t.boxHeader.html(t.opt.header),t.boxClose.one("click",t.events.click),t.boxContent.append(e),t.opt.footer&&t.boxFooter.html(t.opt.footer))),!t.opt.close&&t.boxClose.css("display","none"),o(window).on("resize",t.events.resize).resize(),t.toggle("open")},callback:{open:function(){t.loading||(t.image&&t.boxLoad.remove(),t.opt.afterOpen())},close:function(){o(window).off({keydown:t.events.keydown,resize:t.events.resize}),t.target&&t.target.removeClass(t.opt.prefix+"-helper-class").appendTo(t.boxTemp).unwrap(),t.loading?t.urlLoad.abort():t.opt.afterClose(),t.box.remove()}},toggle:function(e,o){t.opt.animation?(t.loading?t.boxLoad:t.boxBody).addClass("open"==e?t.opt.animateOpen:t.opt.animateClose).one(t.animateEvents,function(){"function"==typeof o?o():t.callback[e]()}):"function"==typeof o?o():t.callback[e]()}},o.extend({edbox:function(e){var t=o.data(window,"edboxData");return"string"==typeof e&&"close"===e&&"object"==typeof t?(t.toggle("close"),void o.removeData(window,"edboxData")):"object"==typeof e?void o.data(window,"edboxData",new n(e)):void 0},edboxDefaults:function(t){return o.extend(e,t)}}).fn.extend({edbox:function(e){this.on("click",function(t){t.preventDefault(),o.data(window,"edboxData",new n(e,this))})}})}({target:null,html:null,image:null,url:null,width:null,height:null,prefix:"edbox",parentClass:"",header:"",footer:"",close:!0,animation:!0,animateOpen:"edbox-animate-open",animateClose:"edbox-animate-close",beforeOpen:function(){},beforeClose:function(){},afterOpen:function(){},afterClose:function(){}},jQuery);