/*
* jQuery Edbox plugin v.2.0.0
* @author Eduardo Moreno - eduardocmoreno[at]gmail[dot]com
* Code under MIT License - http://en.wikipedia.org/wiki/MIT_License
*/
!function(e,o,t){function n(n,a){t=this,t.opt=e.extend({},o,n),t.target=t.opt.target||e(a).attr("data-box-target"),t.html=t.opt.html||e(a).attr("data-box-html"),t.image=t.opt.image||e(a).attr("data-box-image"),t.url=t.opt.url||e(a).attr("href")||e(a).attr("data-box-url"),t.$box=e('<div class="edbox"/>'),t.$boxError=e('<div class="edbox-error"/>'),t.$boxLoad=e('<div class="edbox-load"/>'),t.$boxBody=e('<div class="edbox-body"/>'),t.$boxClose=e('<div class="edbox-close"/>'),t.$boxContent=e('<div class="edbox-content"/>'),t.$boxHeader=e('<div class="edbox-header"/>'),t.$boxFooter=e('<div class="edbox-footer"/>'),t.$boxTemp=e('<div class="edbox-temp"/>'),t.animateEvents="webkitAnimationEnd oanimationend msAnimationEnd animationend",t.init()}n.prototype={init:function(){if(t.base(),!(t.target||t.html||t.image||t.url))return void t.error("undefined content");if(t.opt.beforeOpen(),t.target){var o=e(t.target);return void(o.length?(o.after(t.$boxTemp).addClass("edbox-target"),t.insert(o)):t.error('Unable to find element: "'+t.target+'"'))}return t.html?void t.insert(t.html):t.image?(t.imageObj=new Image,t.imageObj.src=t.image,void(t.imageObj.complete?t.insert(t.imageObj):t.load.start(t.image))):t.url?void t.load.start(t.url):void 0},error:function(e){t.$box.removeClass(t.opt.addClass),t.opt=o,t.responseError=!0,t.$boxError.text("ERROR: "+e).prepend(t.$boxClose.on("click",t.events.click)),t.$box.append(t.$boxError),t.toggle("open")},base:function(){t.$box.addClass(t.opt.addClass).on("click",t.events.click),e("body").prepend(t.$box),e(window).on("keydown",t.events.keydown)},insert:function(o){t.$box.append(t.$boxBody.css({width:t.opt.width,height:t.opt.height}).append(t.opt.header&&t.$boxHeader.html(t.opt.header),t.opt.close&&t.$boxClose.on("click",t.events.click),t.$boxContent.append(o),t.opt.footer&&t.$boxFooter.html(t.opt.footer))),t.toggle("open"),e(window).on("resize",t.events.resize).resize()},toggle:function(e,o){"close"==e&&!t.loading&&!t.responseError&&t.opt.beforeClose(),t.opt.animation?(t.loading?t.$boxLoad:t.responseError?t.$boxError:t.$boxBody).addClass("open"==e?t.opt.animateOpen:t.opt.animateClose).one(t.animateEvents,function(){"function"==typeof o?o():t.callback[e]()}):"function"==typeof o?o():t.callback[e]()},load:{start:function(o){t.loading=!0,t.$box.append(t.$boxLoad),t.toggle("open",function(){t.urlLoad=e.ajax({url:o,cache:!t.image}).fail(function(e){t.load.complete("error",(t.image||t.url)+" "+e.statusText.toLowerCase()+"!")}).done(function(e){t.load.complete("insert",null,t.imageObj||e)})})},complete:function(e,o,n){t.toggle("close",function(){t.loading=!1,t.$boxLoad.remove(),t[e](o||n)})}},events:{click:function(e){t.opt.close&&e.target==e.currentTarget&&t.toggle("close")},keydown:function(e){t.opt.close&&27==e.which&&t.toggle("close")},resize:function(){var e=t.$boxBody.outerHeight(),o=t.$boxHeader.outerHeight(),n=t.$boxFooter.outerHeight(),a=t.$boxContent.get(0).scrollHeight,r=Math.ceil(e-(o+n))<a;t.$boxBody[r?"addClass":"removeClass"]("edbox-scroll-true")}},callback:{open:function(){!t.responseError&&t.opt.afterOpen()},close:function(){e(window).off({keydown:t.events.keydown,resize:t.events.resize}),!t.responseError&&e(t.target).removeClass("edbox-helper-class").appendTo(t.$boxTemp).unwrap(),t.loading?(t.image&&t.imageObj.attr("src",null),t.urlLoad&&t.urlLoad.abort()):t.responseError||t.opt.afterClose(),t.$box.remove(),e.removeData(window,"edbox")}}},e.edboxSettings=function(t){return e.extend(o,t)},e.edbox=function(o,t){var a=e.data(window,"edbox");return"close"==o&&a?void a.toggle("close"):"object"!=typeof o&&!e(t).length||a?void 0:void e.data(window,"edbox",new n(o,t))},e.fn.edbox=function(o){return this.each(function(){e(this).on("click",function(t){t.preventDefault(),e.edbox(o,this)})})}}(jQuery,{target:null,html:null,image:null,url:null,width:null,height:null,addClass:null,header:null,footer:null,close:!0,animation:!0,animateOpen:"edbox-animate-open",animateClose:"edbox-animate-close",beforeOpen:function(){},beforeClose:function(){},afterOpen:function(){},afterClose:function(){}});