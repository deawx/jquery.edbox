/*
* jQuery Edbox plugin v.2.0.0
* @author Eduardo Moreno - eduardocmoreno[at]gmail[dot]com
* Code under MIT License - http://en.wikipedia.org/wiki/MIT_License
*/
!function(e,o,t){function n(n,r){t=this,t.opt=e.extend({},o,n),t.target=t.opt.target||e(r).attr("data-box-target"),t.html=t.opt.html||e(r).attr("data-box-html"),t.image=t.opt.image||e(r).attr("data-box-image"),t.url=t.opt.url||e(r).attr("data-box-url")||e(r).attr("href"),t.$box=e('<div class="'+t.opt.prefix+'"/>'),t.$boxError=e('<div class="'+t.opt.prefix+'-error"/>'),t.$boxLoad=e('<div class="'+t.opt.prefix+'-load"/>'),t.$boxBody=e('<div class="'+t.opt.prefix+'-body"/>'),t.$boxClose=e('<div class="'+t.opt.prefix+'-close"/>'),t.$boxContent=e('<div class="'+t.opt.prefix+'-content"/>'),t.$boxHeader=e('<div class="'+t.opt.prefix+'-header"/>'),t.$boxFooter=e('<div class="'+t.opt.prefix+'-footer"/>'),t.$boxTemp=e('<div class="'+t.opt.prefix+'-temp"/>'),t.animateEvents="webkitAnimationEnd oanimationend msAnimationEnd animationend",t.init()}n.prototype={init:function(){t.base();var o=t.target||t.html||t.image||t.url;if(console.log(o),!o)return void t.error("undefined content");if(t.opt.beforeOpen(),t.target){var n=e(t.target);return void(n.length?(n.after(t.$boxTemp).addClass(t.opt.prefix+"-helper-class"),t.insert(n)):t.error('Unable to find element: "'+t.target+'"'))}return t.html?void t.insert(t.html):t.image?(t.imageObj=new Image,t.imageObj.src=t.image,void(t.imageObj.complete?t.insert(t.imageObj):t.load.start(t.image))):t.url?void t.load.start(t.url):void 0},error:function(e){t.responseError=!0,t.$boxError.text("ERROR: "+e).prepend(t.$boxClose.on("click",t.events.click)),t.$box.append(t.$boxError),t.toggle("open")},base:function(){t.$box.addClass(t.opt.parentClass).one("click",t.events.click),e("body").prepend(t.$box),e(window).one("keydown",t.events.keydown)},insert:function(o){t.$box.append(t.$boxBody.css({width:t.opt.width,height:t.opt.height}).append(t.opt.header&&t.$boxHeader.html(t.opt.header),t.opt.close&&t.$boxClose.one("click",t.events.click),t.$boxContent.append(o),t.opt.footer&&t.$boxFooter.html(t.opt.footer))),e(window).on("resize",t.events.resize).resize(),t.toggle("open")},toggle:function(e,o){"close"==e&&!t.loading&&!t.responseError&&t.opt.beforeClose(),t.opt.animation?(t.loading?t.$boxLoad:t.responseError?t.$boxError:t.$boxBody).addClass("open"==e?t.opt.animateOpen:t.opt.animateClose).one(t.animateEvents,function(){"function"==typeof o?o():t.callback[e]()}):"function"==typeof o?o():t.callback[e]()},load:{start:function(o){t.loading=!0,t.$box.append(t.$boxLoad),t.toggle("open",function(){t.urlLoad=e.ajax({url:o,cache:!t.image}).fail(function(e){console.log(e),t.load.complete("error",e)}).done(function(e){t.load.complete("insert",null,t.imageObj||e)})})},complete:function(e,o,n){t.toggle("close",function(){t.loading=!1,t.$boxLoad.remove(),t[e](o||n)})}},events:{click:function(e){t.opt.close&&e.target==e.currentTarget&&t.toggle("close")},keydown:function(e){t.opt.close&&27==e.which&&t.toggle("close")},resize:function(){var e=t.$boxBody.outerHeight(),o=t.$boxHeader.outerHeight(),n=t.$boxFooter.outerHeight(),r=t.$boxContent.get(0).scrollHeight,a=Math.ceil(e-(o+n))<r;t.$boxBody[a?"addClass":"removeClass"](t.opt.prefix+"-scroll-true")}},callback:{open:function(){!t.responseError&&t.opt.afterOpen()},close:function(){e(window).off({keydown:t.events.keydown,resize:t.events.resize}),!t.responseError&&e(t.target).removeClass(t.opt.prefix+"-helper-class").appendTo(t.$boxTemp).unwrap(),t.loading?(t.image&&t.imageObj.attr("src",null),t.urlLoad&&t.urlLoad.abort()):t.responseError||t.opt.afterClose(),t.$box.remove(),e.removeData(window,"edbox")}}},e.edboxSettings=function(t){return e.extend(o,t)},e.edbox=function(o,t){var r=e.data(window,"edbox");return"close"===o&&r?void r.toggle("close"):"object"!=typeof o&&!e(t).length||r?void 0:void e.data(window,"edbox",new n(o,t))},e.fn.edbox=function(o){this.on("click",function(t){t.preventDefault(),e.edbox(o,this)})}}(jQuery,{target:null,html:null,image:null,url:null,width:null,height:null,prefix:"edbox",parentClass:"",header:"",footer:"",close:!0,animation:!0,animateOpen:"edbox-animate-open",animateClose:"edbox-animate-close",beforeOpen:function(){},beforeClose:function(){},afterOpen:function(){},afterClose:function(){}});